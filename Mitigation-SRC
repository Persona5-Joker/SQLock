# Required library: pip install mysql-connector-python
import mysql.connector
from datetime import datetime

# TODO: Fill this dictionary with your database connection details.
# It is best practice to load these from a separate config file or environment variables.
DB_CONFIG = {
    'host': 'localhost',
    'database': 'your_existing_database_name',
    'user': 'your_webapp_user',
    'password': 'YourStrongAppPassword!'
}

def log_suspicious_activity(bad_input):
    """
    Writes a warning to a 'suspicious_log.txt' file when called.
    Use this in your code whenever an input validation check fails.
    """
    current_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    log_message = f"[{current_time}] Suspicious input blocked: {bad_input}\n"
    with open('suspicious_log.txt', 'a') as log_file:
        log_file.write(log_message)
    print("!!! WARNING: Suspicious activity was detected and logged. !!!")

def find_user_by_id(user_id):
    """
    Safely finds a user using a parameterized query to prevent SQL injection.
    This serves as a template for all functions that read data from your database.
    """
    # --- SECURITY CHECK ---
    # Always validate your inputs before sending them to the database.
    # Here, we expect the ID to be a number (integer).
    if not isinstance(user_id, int):
        log_suspicious_activity(f"Non-integer ID used: {user_id}")
        return None # Stop execution if the input is invalid.

    # The '%s' is a secure placeholder for a parameter.
    query = "SELECT id, username, email FROM users WHERE id = %s"

    try:
        # Establish a connection to the database
        conn = mysql.connector.connect(**DB_CONFIG)
        cursor = conn.cursor(dictionary=True)

        # The database driver safely combines the query and the parameter.
        # The parameter must be in a tuple, e.g., (user_id,)
        cursor.execute(query, (user_id,))

        # Fetch the result
        return cursor.fetchone()

    except Exception as e:
        print(f"An error occurred while connecting to the database: {e}")
        return None

    finally:
        # Ensure the connection is closed, even if errors occur.
        if 'conn' in locals() and conn.is_connected():
            cursor.close()
            conn.close()

#
# TODO: Add your other database functions below, following the same secure pattern.
